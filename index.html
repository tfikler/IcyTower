<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Platformer Game with Screen Scroll</title>
  <style>
    body, html { margin: 0; padding: 0; overflow: hidden; }
    #gameCanvas { background-color: #87CEEB; }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="600" height="600"></canvas>
<script>
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  let lastUpdateTime = Date.now();
  // Game settings
  const gravity = 0.5;
  const friction = 0.8;
  const baseJump = -10; // Base jump velocity

  // Player
  let player = {
    x: canvas.width / 2,
    y: canvas.height - 150,
    width: 20,
    height: 20,
    speed: 5,
    velX: 0,
    velY: 0,
    jumping: false,
    alreadyJumped: false
  };

  // Platforms
  let platforms = [];
  for(let i = 0; i < 10; i++) {
    platforms.push({
      x: Math.random() * (canvas.width - 50),
      y: canvas.height - (100 * i) - 50,
      width: 100,
      height: 10,
      timeOnPlatform: 0, // Track time the player is on the platform
      isTouchedAlready: false,
      falling: false
    });
  }

  // Score
  let score = 0;

  // Key Listener
  let keys = [];
  window.addEventListener('keydown', function(e) {
    keys[e.keyCode] = true;
    if (e.keyCode == 32 && !player.jumping) { // Space key for jump
      player.jumping = true;
      player.alreadyJumped = true;
      player.velY = baseJump - Math.abs(player.velX); // Higher jump if running faster
    }
  });
  window.addEventListener('keyup', function(e) {
    keys[e.keyCode] = false;
  });

  function updateGame() {
    const now = Date.now();
    const deltaTime = (now - lastUpdateTime) / 1000;
    lastUpdateTime = now;
    // Check key inputs
    if (keys[39]) { // right arrow
      if (player.velX < player.speed) {
        player.velX++;
      }
    }
    if (keys[37]) { // left arrow
      if (player.velX > -player.speed) {
        player.velX--;
      }
    }

    player.velX *= friction;
    player.velY += gravity;

    player.x += player.velX;
    player.y += player.velY;

    // Screen scroll
    if (player.y < canvas.height / 4) {
      player.y += Math.abs(player.velY);
      platforms.forEach(platform => {
        platform.y += Math.abs(player.velY);
        if (platform.y > canvas.height) {
          platform.y = 0;
          platform.x = Math.random() * (canvas.width - platform.width);
          score++;
        }
      });
    }

    // Collision with the canvas edges
    if (player.x >= canvas.width - player.width) {
      player.x = canvas.width - player.width;
    } else if (player.x <= 0) {
      player.x = 0;
    }

    if(player.y >= canvas.height - player.height){
      player.y = canvas.height - player.height;
      player.jumping = false;
      player.velY = 0;
    }

    let onPlatform = false;
    // Platform collision
    platforms.forEach(platform => {
      if (!platform.falling) {
        if (
                player.x < platform.x + platform.width &&
                player.x + player.width > platform.x &&
                player.y + player.height > platform.y &&
                player.y + player.height < platform.y + platform.height &&
                player.velY >= 0
        ) {
          player.jumping = false;
          player.velY = 0;
          player.y = platform.y - player.height;
          onPlatform = true;
          platform.isTouchedAlready = true;
          platform.timeOnPlatform += deltaTime;
          if (platform.timeOnPlatform >= 3) { // Make the platform fall
            platform.falling = true;
          }
        } else {
          platform.timeOnPlatform = 0; // Reset if player is not on the platform
        }
      } else {
        platform.y += 5; // Speed of falling
      }
    });

    if ((player.y === canvas.height - player.height) && (player.alreadyJumped)) {
        console.log('jumped');
    }

    if (onPlatform && player.velY === 0) {
      score++;
    }

    // Clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw player
    ctx.fillStyle = 'red';
    ctx.fillRect(player.x, player.y, player.width, player.height);

    // Draw platforms
    platforms.forEach(platform => {
      ctx.fillStyle = 'black';
      ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
    });

    // Score
    ctx.fillStyle = 'black';
    ctx.font = '20px Arial';
    ctx.fillText("Score: " + score, 10, 30);

    requestAnimationFrame(updateGame);
  }

  updateGame();
</script>
</body>
</html>